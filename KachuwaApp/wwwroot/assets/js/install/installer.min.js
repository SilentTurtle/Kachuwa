!function (a) { var e, t, r, n, s, i, o; n = { RegisterTryCount: 0 }, s = function (e, t, r, n, s, i) { a.ajax({ type: "POST", async: !0, url: e, data: t, success: r, error: n, beforeSend: s, complete: i }) }, i = function () { var t = { Email: a.trim(a("#Email").val()), Password: a.trim(a("#Password").val()), SiteName: a.trim(a("input[name=SiteName]").val()), TimeOffset: a.trim(a("#ddlTimeZone").val()), TimeZoneName: a.trim(a("#ddlTimeZone option:selected").attr("stime")) }; s("/install/setupadmin", { model: t }, function (t) { 201 == t.Code && (clearInterval(e), n.IsInstalled && (a("#kachuwa-installation").hide(), a("#user-registration").hide()), a("#user-registration").find("div.summary").hasClass("summary-error") && a("#user-registration").find("div.summary").removeClass("summary-error").html(""), n.User = t.Data.Username, a("#setup-complete").show().jAnimate("bounceInUp")) }, function (a, e) { }, function (e) { a("#btnRegisterUser").addClass("loader").attr("disabled", "disabled"), e.setRequestHeader("RequestVerificationToken", a("#frmSetupUserRegistration input:hidden").val()) }, function () { a("#btnRegisterUser").addClass("loader").attr("disabled", "disabled") }) }, o = function () { var t = { DatabaseServer: a.trim(a("input[name=DatabaseServer]").val()), DatabaseName: a.trim(a("input[name=DatabaseName]").val()), DatabaseUser: a.trim(a("input[name=DatabaseUser]").val()), DatabasePassword: a.trim(a("input[name=DatabasePassword]").val()), DatabaseProvider: a.trim(a("select[name=DatabaseProvider]").val()), ConnectionStrings: a.trim(a("textarea[name=ConnectionStrings]").val()), Port: a.trim(a("input[name=Port]").val()), SiteName: a.trim(a("input[name=SiteName]").val()), Email: a.trim(a("input[name=Email]").val()), Password: a.trim(a("input[name=Password]").val()) }; s("/install", { model: t }, function (t) { 200 == t.Code ? (n.KachuwaInstall = t.Data, n.IsInstalled = !0, e = setInterval(function () { try { a.get("/install/ping", function (a) { "pong" == a && i() }) } catch (a) { } }, 4e3)) : 500 == t.Code && (n.IsInstalled = !1, a("#kachuwa-installation").find("div.summary").addClass("summary-error").html(t.Message), a.isArray(t.Data) && (a("#kachuwa-installation").find("div.summary").append("<ul></ul>"), a(t.Data).each(function (e, t) { a("#kachuwa-installation").find("div.summary").addClass("summary-error").find("ul").append("<li>" + t + "</li>") })), a("#btnInstallKachuwa").removeClass("loader").removeAttr("disabled")) }, function (e) { a("#kachuwa-installation").find("div.summary").addClass("summary-error").html("Oops! Something went wrong. Try again") }, function (e) { a("#btnInstallKachuwa").addClass("loader").attr("disabled", "disabled"), e.setRequestHeader("RequestVerificationToken", a("#frmSetupDBConnection input:hidden").val()) }, function () { a("#btnInstallKachuwa").removeClass("loader").removeAttr("disabled") }) }, t = a("#frmSetupUserRegistration").validate({ rules: { SiteName: { required: !0 }, Email: { required: !0, email: !0 }, Password: { required: !0, minlength: 8 }, ddlTimeZone: { required: !0 } }, messages: { SiteName: "", Email: "", Password: "", ddlTimeZone: "" }, highlight: function (e) { a(e).parents(".form-group:eq(0)").addClass("has-error") }, unhighlight: function (e) { a(e).parents(".form-group:eq(0)").removeClass("has-error") }, errorPlacement: function (a, e) { } }), r = a("#frmSetupDBConnection").validate({ ignore: ".ignore", rules: { DatabaseServer: { required: !0 }, DatabaseUser: { required: !0 }, DatabasePassword: { required: !0 }, DatabaseName: { required: !0 }, ConnectionStrings: { required: !0, minlength: 1 } }, messages: { DatabaseServer: { required: "" }, DatabaseUser: { required: "" }, DatabasePassword: { required: "" }, DatabaseName: { required: "" }, ConnectionStrings: { required: "" } }, highlight: function (e) { a(e).parents(".form-group:eq(0)").addClass("has-error") }, unhighlight: function (e) { a(e).parents(".form-group:eq(0)").removeClass("has-error") }, errorPlacement: function (a, e) { } }), a(document).off("click", "#btnRegisterUser").on("click", "#btnRegisterUser", function () { t.form() ? (a(this).addClass("loader").removeClass("btn-error"), n.IsInstalled ? i() : (a("#user-registration").hide(), a("#kachuwa-installation").show().jAnimate("bounceInUp"))) : a(this).removeClass("loader").addClass("btn-error") }), a(document).off("click", "#btnTestConnection").on("click", "#btnTestConnection", function (e) { var t; t = { DatabaseServer: a.trim(a("input[name=DatabaseServer]").val()), DatabaseName: a.trim(a("input[name=DatabaseName]").val()), DatabaseUser: a.trim(a("input[name=DatabaseUser]").val()), DatabasePassword: a.trim(a("input[name=DatabasePassword]").val()), DatabaseProvider: a.trim(a("select[name=DatabaseProvider]").val()), ConnectionStrings: a.trim(a("textarea[name=ConnectionStrings]").val()), Port: a.trim(a("input[name=Port]").val()), SiteName: a.trim(a("input[name=SiteName]").val()), Email: a.trim(a("input[name=Email]").val()), Password: a.trim(a("input[name=Password]").val()) }, s("/install/checkconnection", { model: t }, function (e) { 200 == e.Code ? (n.ConnectionTest = e.Data, a("#kachuwa-installation").find("div.summary").hasClass("summary-error") && a("#kachuwa-installation").find("div.summary").removeClass("summary-error").html(""), a("#kachuwa-installation").find("div.summary").addClass("summary-success").html(e.Message), a("#btnTestConnection").removeClass("btn-error").addClass("btn-info")) : (a("#kachuwa-installation").find("div.summary").addClass("summary-error").html(e.Message), a("#btnTestConnection").removeClass("btn-info").addClass("btn-error")) }, function (e) { a("#kachuwa-installation").find("div.summary").addClass("summary-error").html("Connection Error!") }, function (e) { a("#btnTestConnection").addClass("loader").attr("disabled", "disabled"), e.setRequestHeader("RequestVerificationToken", a("#frmSetupDBConnection input:hidden").val()) }, function () { a("#btnTestConnection").removeClass("loader").removeAttr("disabled") }) }), a(document).off("click", "#btnInstallKachuwa").on("click", "#btnInstallKachuwa", function () { a("#kachuwa-installation").find("div.summary").removeClass("summary-success").empty(), r.form() ? (a(this).addClass("loader").removeClass("btn-error"), o()) : a(this).removeClass("loader").addClass("btn-error") }), a(document).off("keypress", "#Password, #DatabaseName"), a(document).on("keypress", "#Password, #DatabaseName", function (e) { var t = e.currentTarget.id; if (13 === e.which) switch (t) { case "Password": a("#btnRegisterUser").trigger("click"); break; case "DatabaseName": a("#btnInstallKachuwa").trigger("click"); break; default: alert("Warning") } }), a("select[name=DatabaseProvider]").change(function () { var e = a(this).val(); "SQLServer" == e ? a("input[name=Port]").val("") : "PostgreSQL" == e ? a("input[name=Port]").val(5432) : "MySQL" == e ? a("input[name=Port]").val(3306) : a("input[name=Port]").val("") }) }(jQuery);